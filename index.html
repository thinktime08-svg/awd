<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë§ˆìŒ ì¼ê¸° - í‚¤ì›Œë“œì—ì„œ ì¼ê¸°ê¹Œì§€</title>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Noto+Sans+KR:wght@300;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #6c5ce7;
            --paper: #fffef0;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f2f5;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        .container { width: 100%; max-width: 500px; }

        /* ì…ë ¥ì°½ ë° í—¤ë” */
        header { text-align: center; margin-bottom: 30px; }
        header h1 { color: var(--primary); font-size: 1.8rem; }

        .input-card {
            background: white; padding: 20px; border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px;
        }

        textarea {
            width: 100%; height: 100px; border: 1px solid #eee;
            border-radius: 12px; padding: 15px; font-size: 16px;
            resize: none; box-sizing: border-box; outline: none;
        }

        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button {
            flex: 1; padding: 12px; border: none; border-radius: 10px;
            cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        .btn-main { background: var(--primary); color: white; }
        .btn-save { background: #00b894; color: white; display: none; }
        .btn-download { background: #fab1a0; color: white; display: none; }

        /* ì¼ê¸°ì¥(ê²°ê³¼ì°½) */
        #diary-capture-area {
            display: none; margin-top: 20px; padding: 10px;
        }

        .paper {
            background-color: var(--paper);
            background-image: linear-gradient(#e5e5e5 1px, transparent 1px);
            background-size: 100% 30px; /* ì¤„ë…¸íŠ¸ íš¨ê³¼ */
            padding: 40px 30px; border-radius: 2px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            position: relative; line-height: 30px;
        }

        .paper::before { /* ì™¼ìª½ ë¹¨ê°„ ì¤„ */
            content: ''; position: absolute; left: 20px; top: 0; bottom: 0;
            width: 1px; background: rgba(255,0,0,0.2);
        }

        .date { font-family: 'Nanum Pen Script'; font-size: 24px; color: #d63031; border-bottom: none; }
        .emotion { font-size: 40px; margin: 10px 0; text-align: right; }
        .content { font-family: 'Nanum Pen Script'; font-size: 26px; min-height: 200px; color: #2d3436; }

        /* ì €ì¥ëœ ëª©ë¡ */
        .history { width: 100%; margin-top: 40px; }
        .history h3 { font-size: 1rem; color: #666; }
        .history-item { 
            background: white; padding: 10px 15px; border-radius: 10px; 
            margin-bottom: 10px; font-size: 0.9rem; display: flex; justify-content: space-between;
        }

        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        #loading { display: none; margin: 10px 0; font-size: 0.9rem; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>âœï¸ AI ë§ˆìŒ ì¼ê¸°</h1>
        <p>ë‹¨ì–´ë§Œ ë˜ì§€ì„¸ìš”, ì¼ê¸°ëŠ” ì œê°€ ì“¸ê²Œìš”.</p>
    </header>

    <div class="input-card">
        <textarea id="userInput" placeholder="ì˜¤ëŠ˜ ì¹œêµ¬ë‘ ê°•ë‚¨ì—ì„œ ë§Œë‚¨. ë–¡ë³¶ì´ ë¨¹ìŒ. ê¸°ë¶„ ìµœê³ !"></textarea>
        <div id="loading">âœ¨ AIê°€ ê°ì •ì„ ë¶„ì„í•˜ê³  ì¼ê¸°ë¥¼ ì“°ê³  ìˆì–´ìš”...</div>
        <div class="btn-group">
            <button class="btn-main" onclick="generateDiary()">ì¼ê¸° ë§Œë“¤ê¸°</button>
        </div>
    </div>

    <div id="diary-capture-area">
        <div class="paper" id="paper">
            <div class="date" id="resDate"></div>
            <div class="emotion" id="resEmoji"></div>
            <div class="content" id="resContent"></div>
        </div>
        <div class="btn-group">
            <button class="btn-save" id="saveBtn" onclick="saveToStorage()">ì¼ê¸°ì¥ì— ë³´ê´€í•˜ê¸°</button>
            <button class="btn-download" id="downBtn" onclick="downloadImage()">ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
        </div>
    </div>

    <div class="history">
        <h3>ìµœê·¼ ì‘ì„±í•œ ê¸°ë¡</h3>
        <div id="historyList"></div>
    </div>
</div>

<script>
    // 1. ì¼ê¸° ìƒì„± (AI ì‹œë®¬ë ˆì´ì…˜)
    function generateDiary() {
        const input = document.getElementById('userInput').value;
        if(!input) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

        document.getElementById('loading').style.display = 'block';
        
        // AIê°€ ìƒê°í•˜ëŠ” ì²™ 1.5ì´ˆ ì§€ì—°
        setTimeout(() => {
            const now = new Date();
            const dateStr = `${now.getMonth()+1}ì›” ${now.getDate()}ì¼ ${getDay(now.getDay())}ìš”ì¼`;
            
            // ê°ì • ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
            let emoji = "ğŸ™‚";
            let diaryText = "";

            if(input.includes("ê¸°ë¶„") || input.includes("ìµœê³ ") || input.includes("í–‰ë³µ")) {
                emoji = "ğŸ¥°";
                diaryText = `í–‡ì‚´ë§Œí¼ì´ë‚˜ ëˆˆë¶€ì‹  í•˜ë£¨ì˜€ë‹¤. ${input}... ì´ ëª¨ë“  ìˆœê°„ì´ ë‚˜ì—ê²ŒëŠ” í° ì„ ë¬¼ ê°™ì•˜ë‹¤. ì˜¤ëŠ˜ì˜ ì´ ëª½ê¸€ëª½ê¸€í•œ ê¸°ë¶„ì„ ìŠì§€ ì•Šê³  ë§ˆìŒì†ì— ì˜ ê°„ì§í•´ì•¼ì§€.`;
            } else if(input.includes("í”¼ê³¤") || input.includes("í˜ë“¤")) {
                emoji = "ğŸ˜´";
                diaryText = `ëª¸ë„ ë§ˆìŒë„ ì¡°ê¸ˆì€ ì§€ì¹œ ì˜¤ëŠ˜. ${input} ë“±ì˜ ì¼ë“¤ì´ ìˆì—ˆì§€ë§Œ, ê·¸ë˜ë„ ë¬´ì‚¬íˆ í•˜ë£¨ë¥¼ ë§ˆë¬´ë¦¬í•œ ë‚˜ ìì‹ ì—ê²Œ ìˆ˜ê³ í–ˆë‹¤ê³  ë§í•´ì£¼ê³  ì‹¶ë‹¤. ë‚´ì¼ì€ ì¢€ ë” ê°€ë²¼ìš´ ë°œê±¸ìŒì´ê¸¸.`;
            } else {
                emoji = "ğŸ“";
                diaryText = `ë‹´ë‹´í•˜ê²Œ í˜ëŸ¬ê°„ ì˜¤ëŠ˜ í•˜ë£¨ì˜ ê¸°ë¡. ${input}... íŠ¹ë³„í•œ ì¼ì´ ì—†ì–´ë„ ì´ë ‡ê²Œ ë‚´ ë§ˆìŒì„ ì ì–´ ë‚´ë ¤ê°€ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì¶©ë¶„íˆ ì˜ë¯¸ ìˆëŠ” ì‹œê°„ì´ë‹¤.`;
            }

            document.getElementById('resDate').innerText = dateStr;
            document.getElementById('resEmoji').innerText = emoji;
            document.getElementById('resContent').innerText = diaryText;
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('diary-capture-area').style.display = 'block';
            document.getElementById('saveBtn').style.display = 'block';
            document.getElementById('downBtn').style.display = 'block';
        }, 1500);
    }

    function getDay(n) { return ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][n]; }

    // 2. ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸° (html2canvas)
    function downloadImage() {
        const paper = document.getElementById('paper');
        html2canvas(paper).then(canvas => {
            const link = document.createElement('a');
            link.download = 'my-ai-diary.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    // 3. ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (DB ëŒ€ìš©)
    function saveToStorage() {
        const diaryData = {
            date: document.getElementById('resDate').innerText,
            emoji: document.getElementById('resEmoji').innerText,
            text: document.getElementById('resContent').innerText.substring(0, 15) + "..."
        };

        let history = JSON.parse(localStorage.getItem('myDiaries') || '[]');
        history.unshift(diaryData);
        localStorage.setItem('myDiaries', JSON.stringify(history));
        
        alert("ì¼ê¸°ì¥ì— ì•ˆì „í•˜ê²Œ ë³´ê´€ë˜ì—ˆìŠµë‹ˆë‹¤!");
        loadHistory();
    }

    function loadHistory() {
        const history = JSON.parse(localStorage.getItem('myDiaries') || '[]');
        const listDiv = document.getElementById('historyList');
        listDiv.innerHTML = history.map(d => `
            <div class="history-item">
                <span>${d.emoji} ${d.date}</span>
                <span style="color: #888;">${d.text}</span>
            </div>
        `).join('');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ì¡´ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    window.onload = loadHistory;
</script>

</body>
</html>
